# release-automation Specification

## Purpose
TBD - created by archiving change add-release-deb-workflow. Update Purpose after archive.
## Requirements
### Requirement: Tag-triggered Deb Packages
GitHub Actions MUST produce Debian-compatible packages whenever a semver tag is pushed.

#### Scenario: Tag push builds packages
- **GIVEN** a tag named `v1.2.3` (pattern `v<major>.<minor>.<patch>`) is pushed to the repository
- **THEN** a workflow runs on `ubuntu-latest`, checks out the code, installs packaging dependencies (`debhelper`, `dpkg-dev`, `curl`, `bzip2`, etc.), ensures `CARGO_HOME="$(pwd)/.cargo-home"`, and invokes `build/package-deb.sh --distro debian` and `--distro ubuntu`
- **AND** the workflow archives the resulting `.deb` artifacts from `dist/`

### Requirement: Release Asset Upload
The workflow MUST attach the generated artifacts to the GitHub Release for the tag.

#### Scenario: Release assets present
- **WHEN** the workflow completes successfully
- **THEN** it creates (if necessary) a GitHub Release for the tag with autogenerated release notes
- **AND** uploads each `.deb` file as a release asset with clear filenames (e.g., `chissu-pam_1.2.3_debian_amd64.deb`)
- **AND** the job fails if upload fails, ensuring missing assets surface immediately

### Requirement: Documented Release Process
Maintainers MUST have documentation explaining how to trigger and verify the automated release.

#### Scenario: README describes tagging flow
- **WHEN** a maintainer reads the release section
- **THEN** they learn to push a `v<MAJOR>.<MINOR>.<PATCH>` tag, wait for the workflow, and confirm `.deb` assets on GitHub Releases, including notes about required permissions and how to re-run a failed job.

### Requirement: Tag-triggered RPM Packages
The GitHub Actions release workflow MUST produce RPM artifacts whenever a `v<MAJOR>.<MINOR>.<PATCH>` tag is pushed.

#### Scenario: Tag push builds RPMs
- **WHEN** the release workflow runs for tag `v1.2.3`
- **THEN** it installs the necessary RPM tooling (`rpm-build`, `createrepo_c`, etc.) and executes `build/package-rpm.sh` for each supported distro, storing the resulting `.rpm` files under `dist/`
- **AND** failures building the RPM cause the workflow to fail so releases are never missing RPM assets silently

### Requirement: RPM Release Assets
GitHub Releases MUST include the RPM artifacts beside the `.deb` files.

#### Scenario: RPM assets uploaded
- **WHEN** the workflow publishes assets for tag `v1.2.3`
- **THEN** it uploads each generated `.rpm` file (e.g., `chissu-pam-1.2.3.fedora.x86_64.rpm`) to the tagâ€™s GitHub Release via the same step that publishes `.deb` files
- **AND** the workflow surfaces an error if any `.rpm` upload fails so maintainers can rerun the job

